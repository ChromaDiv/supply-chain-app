<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /

  # 1. Route API requests to the Python backend
  RewriteCond %{REQUEST_URI} ^/api/ [NC]
  RewriteRule ^(.*)$ passenger_wsgi.py/$1 [L]

  # 2. Serve static files from static/dist if they exist
  # This maps /assets/foo.js -> /static/dist/assets/foo.js
  RewriteCond %{DOCUMENT_ROOT}/static/dist%{REQUEST_URI} -f
  RewriteRule ^(.*)$ static/dist/$1 [L]

  # 3. Route everything else to static/dist/index.html (SPA Fallback)
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_URI} !^/api/
  RewriteRule ^ static/dist/index.html [L]
</IfModule>